<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ÏÉÅÌíà ÏÉÅÏÑ∏ Ï†ïÎ≥¥</title>
    <script src="/CarrotEasy/resource/js/jquery-3.7.1.js"></script>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Ìè¨Ìä∏Ïõê Í≤∞Ï†ú -->
    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
    <!-- jQuery -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <!-- iamport.payment.js -->
    <script type="text/javascript" src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>
    <!-- Ìè¨Ìä∏Ïõê Í≤∞Ï†ú -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
        <style>
        .container {
            max-width: 1180px;
            margin: 0 auto;
            background-color: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .title-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            border-bottom: 1px solid #eee;
            gap: 0;
        }
        .shop-link {
            font-size: 14px;
            text-decoration: none;
            color: #007bff;
            font-weight: 500;
            margin-top: 25px;
            margin-right: 0;
            text-decoration: underline;
        }
        h1 {
            color: #333;
            margin-bottom: 5px;
            padding-bottom: 5px;
        }
        .product-info {
            margin-bottom: 30px;
        }
        .product-meta {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .product-price {
            font-size: 24px;
            font-weight: bold;
            color: #ff6b00;
            margin: 15px 0;
        }
        .product-status {
            display: inline-block;
            padding: 5px 10px;
            background-color: #e0e0e0;
            color: #333;
            border-radius: 5px;
            font-size: 12px;
            margin-right: 10px;
        }
        .product-content {
            line-height: 1.6;
            margin-bottom: 30px;
            white-space: pre-line;
        }
        .product-location {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        .product-price-wrapper {
            display: flex;
            align-items: center;
            justify-content: space-between; 
            margin-top: 10px;
        }
        .jjim-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0;
        }
        .jjim-icon {
            width: 28px;
            height: 28px;
        }
        .jjim-wrapper {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .product-location p {
            margin: 0;
            color: #555;
        }
        .image-gallery {
            margin-bottom: 30px;
        }
        .gallery-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .main-image {
            width: 100%;
            height: 400px;
            object-fit: contain;
            margin-bottom: 10px;
            background-color: #f8f8f8;
            border-radius: 5px;
        }
        .thumbnail {
            width: 80px;
            height: 80px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 5px;
        }
        .thumbnail.active {
            border-color: #ff6b00;
        }
        .btn-group {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-group-right {
            margin-left: auto;
            display: flex;
            gap: 10px;
        }
        .btn {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
        }
        .btn-back {
            background-color: #6c757d;
            color: white;
        }
        .btn-primary {
            background-color: #FF8A3D;
            color: white;
        }
		.btn-good {
		    background-color: #FF8A3D;
		    color: white;
		    padding: 10px 20px;
		    font-size: 16px;
		    border: none;
		    border-radius: 5px;
		    cursor: pointer;
		    text-decoration: none;
		    text-align: center;
		}
        #buyer-select {
		    padding: 8px 12px;
		    padding-right: 30px; /* üëà ÏïÑÏù¥ÏΩòÏù¥Îûë Ïïà Í≤πÏπòÍ≤å */
		    border: 1px solid #ccc;
		    border-radius: 6px;
		    font-size: 14px;
		    background-color: #fff;
		    color: #333;
		    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
		    outline: none;
		    appearance: none;
		    background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg width='14' height='10' viewBox='0 0 14 10' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23666' d='M7 10L0 0h14z'/%3E%3C/svg%3E");
		    background-repeat: no-repeat;
		    background-position: right 10px center;
		    background-size: 16px;
		}
		#status-select {
		    padding: 8px 12px;
		    border: 1px solid #ccc;
		    border-radius: 6px;
		    font-size: 14px;
		    background-color: #fff;
		    color: #333;
		    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
		    outline: none;
		    appearance: none;
		    background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg width='14' height='10' viewBox='0 0 14 10' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%23666' d='M7 10L0 0h14z'/%3E%3C/svg%3E");
		    background-repeat: no-repeat;
		    background-position: right 10px center;
		    background-size: 12px;
		}
    </style>
   
    <script>
		const prodNo = '${prod.prodNo}'; // ÏÉÅÌíà Î≤àÌò∏
		const memNo = '${sessionScope.member.memNo}'; // Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê Î≤àÌò∏ 
		const prodType = '${prod.prodType}';

	    function toggleLike() {
	        const heartIcon = document.getElementById('heartIcon');
	        if (heartIcon.classList.contains('fa-regular')) {
	            heartIcon.classList.remove('fa-regular');
	            heartIcon.classList.add('fa-solid');
	            
	            $.ajax({
	            	url: "/CarrotEasy/jjim.do",
                	method: "GET",
                	dataType: "json",
                	data: { prodJJim : "on", prodNo: prodNo, memNo: memNo},
                	success: function(res) {
                	    console.log("Ï∞ú ÏÑ±Í≥µ", res);
                	    $('#jjimCountText').text(res.jjimCount + 'Î™ÖÏù¥ Ï∞úÌñàÏñ¥Ïöî');
                	},error: function(xhr, status, error) {
	                    console.error("Ïã§Ìå®:", error);
	                }
                });
	        } else {
	            heartIcon.classList.remove('fa-solid');
	            heartIcon.classList.add('fa-regular');
	            
	            $.ajax({
	            	url: "/CarrotEasy/jjim.do",
                	method: "GET",
                	dataType: "json",
                	data: { prodJJim : "off",prodNo: prodNo, memNo: memNo },
                	success: function(res) {
						console.log("Ï∞ú Ï∑®ÏÜå ÏÑ±Í≥µ",res);
						 $('#jjimCountText').text(res.jjimCount + 'Î™ÖÏù¥ Ï∞úÌñàÏñ¥Ïöî');
                	},error: function(xhr, status, error) {
	                    console.error("Ïã§Ìå®:", error);
	                }
                });
	        }
	        
	        
	    }		
    
    
        function changeMainImage(imagePath, thumbnail) {
            // Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ Î≥ÄÍ≤Ω
		    document.getElementById('mainImage').src = '/CarrotEasy' + imagePath;
            
            // ÏÑ†ÌÉùÎêú Ïç∏ÎÑ§Ïùº Í∞ïÏ°∞
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach(item => {
                item.classList.remove('active');
            });
            thumbnail.classList.add('active');
        }
        
        function deleteProd(prodNo) {
            if (confirm('Ï†ïÎßê Ïù¥ ÏÉÅÌíàÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                location.href = '/CarrotEasy/prod/delete.do?prodNo=' + prodNo;
            }
        }
	
        function alertTalk() {
        	const isLoggedIn = '${member != null}';
        	
        	 if (isLoggedIn !== 'true') {
                 // ÎπÑÌöåÏõêÏù∏ ÏÉÅÌÉú ‚Üí Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú
                	alert("ÏùºÎ∞òÏÇ¨Ïö©ÏûêÎßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.");
             }
		}
        
		//Ïπ¥Ïπ¥Ïò§ÌéòÏù¥ Í≤∞Ï†ú

		const prodName = '${prod.prodTitle}';   
	    const prodPrice = '${prod.prodPrice}';
	    var buyerNo = null;

		var IMP = window.IMP;

        function kakaoPay(prodName, prodPrice,payType) {
        	
            const isLoggedIn = '${member != null}'; 

            if (isLoggedIn !== 'true') {
                // ÎπÑÌöåÏõêÏù∏ ÏÉÅÌÉú ‚Üí Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú
               	alert("Î°úÍ∑∏Ïù∏ ÌõÑ Íµ¨Îß§Í∞Ä Í∞ÄÎä•Ìï©ÎãàÎã§");
                // window.location.href = '/CarrotEasy/login.do';
            }else{
            	// ÌöåÏõêÏùº Îïå
				var today = new Date();
	        	var hours = today.getHours(); // Ïãú
	        	var minutes = today.getMinutes();  // Î∂Ñ
	        	var seconds = today.getSeconds();  // Ï¥à
	        	var milliseconds = today.getMilliseconds();
	        	var makeMerchantUid = hours + "" + minutes + "" + seconds + "" + milliseconds;
	
	        	console.log("makeMerchantUid ==>", makeMerchantUid);
	    		
	        	if(confirm("Íµ¨Îß§ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) { // Íµ¨Îß§ ÌÅ¥Î¶≠Ïãú ÌïúÎ≤à Îçî ÌôïÏù∏ÌïòÍ∏∞
	  				console.log("payType ==>",payType);
		
		            const buyerEmail = document.getElementById('buyerEmail').value;
		            const buyerName = document.getElementById('buyerName').value;
	
		            IMP.init("imp74712831"); // Í∞ÄÎßπÏ†ê ÏãùÎ≥ÑÏΩîÎìú
		
		            IMP.request_pay({
		                pg: "kakaopay.TC0ONETIME", // ÌÖåÏä§Ìä∏Ïö© Ïπ¥Ïπ¥Ïò§ÌéòÏù¥
		                pay_method: "card",
		                merchant_uid: "IMP" + makeMerchantUid, // Ï£ºÎ¨∏Î≤àÌò∏ ÏÉùÏÑ±
		                name: prodName,
		                amount: prodPrice,
		                buyer_email: buyerEmail,
		                buyer_name: buyerName
		            }, function (rsp) {
		                if (rsp.success) {
		                    console.log(rsp);
		                    $.ajax({
		                    	url: "/CarrotEasy/kakaopay.do",
		                    	method: "GET",
		                    	data: { prodNo: prodNo, memNo: memNo, payType: payType },
		                    	success: function(res) {
									console.log("ÏÑ±Í≥µ",res);
									location.reload();
		                    	},error: function(xhr, status, error) {
				                    console.error("Ïã§Ìå®:", error);
				                }
		                    });
		                } else {
		                    alert("Í≤∞Ï†ú Ïã§Ìå®: " + rsp.error_msg);
		                }
		            });
	            }else { // Íµ¨Îß§ ÌôïÏù∏ ÏïåÎ¶ºÏ∞Ω Ï∑®ÏÜå ÌÅ¥Î¶≠Ïãú ÎèåÏïÑÍ∞ÄÍ∏∞
	    	        return false;
	    	    }
            }
        }
        
        // ÌåùÏóÖÏ∞Ω
        function openWindowPop() {
        	if (!buyerNo) {
                alert('Íµ¨Îß§ÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }
        	
        	var options = 'top=10, left=10, width=500, height=1600, status=no, menubar=no, toolbar=no, resizable=no';
        	var url = "/CarrotEasy/kakaoQuick.do?prodNo=" + prodNo;
        	window.open(url, "Ïπ¥Ïπ¥Ïò§ÌÄµÏÑ†ÌÉùÏ∞Ω", options);
        }
		// Î¶¨Î∑∞ insertÌåùÏóÖÏ∞Ω
        function openinsertPop() {
        	var options = 'top=10, left=10, width=500, height=500, status=no, menubar=no, toolbar=no, resizable=no';
        	const url = "/CarrotEasy/reivew/insertReviewForm.do?prodNo="+ prodNo + "&memNo="+ memNo;
        	window.open(url, "ÏÉÅÌíàÎ¶¨Î∑∞ Îì±Î°ùÏ∞Ω", options);
        }
		// Ïã†Í≥† insertÌåùÏóÖÏ∞Ω
		function insertReport() {
		    var options = 'top=10,left=10,width=500,height=500,status=no,menubar=no,toolbar=no,resizable=no';
		    const url = "/CarrotEasy/ReportInsertForm.do?prodTitle="+ prodName;
		    console.log(prodName);
		    window.open(url, "ÏÉÅÌíàÏã†Í≥† Îì±Î°ùÏ∞Ω", options);
		}

        function openTrackingPage(partnerId, prodNo, buyerNo) {
        	buyerNo = $('#buyer-select').val();
            const url = "/CarrotEasy/api/deliveryStatus.do?partnerOrderId=" + encodeURIComponent(partnerId) + "&prodNo=" + encodeURIComponent(prodNo) + "&buyerNo=" + encodeURIComponent(buyerNo);
            const options = "width=500,height=1600,top=50,left=100,resizable=no,scrollbars=yes";

            console.log("Opening tracking page with URL:", url);

            window.open(url, "Î∞∞ÏÜ°Ï°∞Ìöå", options);
        }
        
        function receiveDeliveryInfo(partnerOrderId) {
            const oldButton = document.querySelector("button[onclick='openWindowPop()']");
            if (oldButton) oldButton.remove();

            const newBtn = document.createElement("button");
            newBtn.className = "btn btn-info";
            newBtn.textContent = "Î∞∞ÏÜ°Ï°∞Ìöå";
            newBtn.onclick = function () {
                openTrackingPage(partnerOrderId, prodNo, buyerNo); // partnerOrderIdÎäî Î∞∞ÏÜ° ID
            };

            document.querySelector(".btn-group").appendChild(newBtn);
        }
        
        $(document).ready(function() {
        	$('#buyer-select').on('change', function () {
            	buyerNo = $(this).val();
            	console.log(buyerNo);
            });
        	
        	$('#sellerTel').on('click', function() {
        		var memNo = $(this).data('memno');
        		var prodNo = $(this).data('prodno');
        		$('#main-content').load('/CarrotEasy/chattingroom.do?memNo=' + memNo + '&prodNo=' + prodNo + '&source=prodView');
        	});
        	
        	$.ajax({
                url: '/CarrotEasy/prod/getBuyersByProd.do',
                method: 'GET',
                data: { prodNo: prodNo }, // prodNoÎäî ÏÉÅÎã®ÏóêÏÑú Ï†ÑÏó≠ ÏÑ†Ïñ∏ÎêòÏñ¥ ÏûàÏñ¥Ïïº Ìï®
                success: function (response) {
                    const $select = $('#buyer-select');
                    $select.empty().append('<option value=""> ÏÑ†ÌÉùÌïòÏÑ∏Ïöî   </option>');
                    response.forEach(function (buyer) {
                        $select.append("<option value=" + buyer.memNo+ ">" + buyer.memNick + "</option>");
                    });
                },
                error: function () {
                    alert("Íµ¨Îß§Ïûê Î™©Î°ùÏùÑ Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.");
                }
            });
        	
            $('#status-select').on('change', function() {
                const selectedValue = $(this).val();

                if (!buyerNo) {
                    alert('Íµ¨Îß§ÏûêÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.');
                    return;
                }
                
                if (selectedValue === 'SOLD_OUT') {
	                	 
	                const confirmed = confirm('Ï†ïÎßêÎ°ú ÌåêÎß§Î•º ÏôÑÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?');
	                if (!confirmed) return;
	
	                // Í±∞Îûò ÏôÑÎ£å Ï≤òÎ¶¨ AJAX
	                $.ajax({
	                    url: '/CarrotEasy/prod/completeDeal.do',
	                    method: 'POST',
	                    data: {
	                        prodNo: prodNo,
	                        memNo: buyerNo,
	                        purchaseType: 'ÎåÄÎ©¥'
	                    },
	                    success: function (response) {
	                        alert("Í±∞ÎûòÍ∞Ä ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§.");
	                        location.reload();
	                    },
	                    error: function () {
	                        alert("Í±∞Îûò ÏôÑÎ£å Ï≤òÎ¶¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.");
	                    }
	                });
               	}
            });
        });
        
        function cancelDeal() {
            // Î™®Îã¨Í≥º Ïò§Î≤ÑÎ†àÏù¥ Ïà®Í∏∞Í∏∞
            $('#dealModal, #modalOverlay').hide();

            // ÏÉÅÌíà ÏÉÅÌÉú select ÏöîÏÜåÏùò Í∞íÏùÑ 'RESERVED'Î°ú ÎêòÎèåÎ¶¨Í∏∞
            $('#status-select').val(prodType);
        }
    </script>
    
</head>
<body>
    <div class="container">
        <div class="title-row">
		    <h1>${prod.prodTitle}</h1>
            <div>
	            <c:if test="${sessionScope.member.memNo != prod.memNo && sessionScope.member.memNo != null}">
		            <button type="button" onclick="insertReport()"
					        style="background: none; border: none; padding: 0; color: #007bff; text-decoration: underline; cursor: pointer; font-size: 14px;"
					        class="shop-link">üö® Ïã†Í≥†ÌïòÍ∏∞</button>
				</c:if>
				<c:if test="${not empty sessionScope.member and sessionScope.member.memNo != prod.memNo}">
					<a href="/CarrotEasy/mystore/mystoreMain.do?prodNo=${prod.prodNo}" class="shop-link">üõí ÌåêÎß§Ïûê ÏÉÅÏ†êÍ∞ÄÍ∏∞</a>
				</c:if>
			</div>
		</div>
		<!-- Íµ¨Îß§Ïûê(Î°úÍ∑∏Ïù∏ ÏÇ¨Ïö©Ïûê) Ï†ïÎ≥¥ Ïà®Í∏∞Í∏∞ -->
		<input type="hidden" id="memNo" value="${sessionScope.loginUser.memNo}">
		<input type="hidden" id="buyerEmail" value="${sessionScope.member.memEmail}">
		<input type="hidden" id="buyerName" value="${sessionScope.member.memNo}">
        
        <div class="product-meta">
            <div>
                <span>Ïπ¥ÌÖåÍ≥†Î¶¨: ${prod.cateName}</span>
            </div>
            <div></div>
            <div></div>
            <div></div>
            <div>
            	<span>Ï°∞ÌöåÏàò: ${prod.prodCnt}</span>
            </div>
            <div>
                <span>Îì±Î°ùÏùº: ${prod.createDate}</span>
            </div>
        </div>
        
        <img id="mainImage" class="main-image" 
		     src="/CarrotEasy${fileList[0].filePath}" 
		     alt="${prod.prodTitle}">
		
		<div class="gallery-container">
		    <c:forEach items="${fileList}" var="file" varStatus="status">
		        <img class="thumbnail ${status.index == 0 ? 'active' : ''}" 
		             src="/CarrotEasy${file.filePath}" 
		             alt="ÏÉÅÌíà Ïù¥ÎØ∏ÏßÄ ${status.index + 1}"
		             onclick="changeMainImage('${file.filePath}', this)">
		    </c:forEach>
		</div>
        
        <div class="product-info">
            <div class="product-price-wrapper">
			    <div class="product-price">
			        <fmt:formatNumber value="${prod.prodPrice}" type="number" pattern="#,###"/>Ïõê
			    </div>
			    	<div class="jjim-wrapper">
			    		<c:if test="${sessionScope.member.memNo != prod.memNo && sessionScope.member.memNo != null}"> <!-- ÎπÑÌöåÏõêÏùº Ïãú Îú®ÏßÄ ÏïäÏùå -->
					        <button id="likeBtn" onclick="toggleLike()" style="background: none; border: none; cursor: pointer;">
						        <i id="heartIcon" class="fa-${jjimCheck ? 'solid' : 'regular'} fa-heart fa-2x" style="color: red;"></i>
						    </button>
						 </c:if>   
					    <span id="jjimCountText">${jjimCount}Î™ÖÏù¥ Ï∞úÌñàÏñ¥Ïöî</span>
				    </div>
			</div>
            <div>
                <span class="product-status">
                    <c:choose>
                        <c:when test="${prod.prodStatus == 'NEW'}">ÏÉàÏÉÅÌíà</c:when>
                        <c:when test="${prod.prodStatus == 'ALMOST_NEW'}">Í±∞Ïùò ÏÉàÍ≤É</c:when>
                        <c:when test="${prod.prodStatus == 'SLIGHTLY_USED'}">Ï§ëÍ≥†</c:when>
                        <c:when test="${prod.prodStatus == 'USED'}">Ïò§ÎûòÎê®</c:when>
                    </c:choose>
                </span>
                
                <span class="product-status">
                    <c:choose>
                        <c:when test="${prod.prodType == 'FOR_SALE'}">ÌåêÎß§Ï§ë</c:when>
                        <c:when test="${prod.prodType == 'RESERVED'}">ÏòàÏïΩÏ§ë</c:when>
                        <c:when test="${prod.prodType == 'SOLD_OUT'}">ÌåêÎß§ÏôÑÎ£å</c:when>
                    </c:choose>
                </span>
     			<c:if test="${prod.prodType != 'SOLD_OUT'}">
	                <c:if test="${sessionScope.member.memNo == prod.memNo}">
		                <span id="buyer-section" style="margin-top: 20px;">
						    <label for="buyer-select">Íµ¨Îß§Ïûê ÏÑ†ÌÉù:</label>
						    <select id="buyer-select">
						        <option value="">-- ÏÑ†ÌÉùÌïòÏÑ∏Ïöî --</option>
						    </select>
						</span>
		                <span class="prod-status">
		                	<select id="status-select">
		                		<option value="FOR_SALE" ${prod.prodType == 'FOR_SALE' ? 'selected' : ''}>ÌåêÎß§Ï§ë</option>
							    <option value="RESERVED" ${prod.prodType == 'RESERVED' ? 'selected' : ''}>ÏòàÏïΩÏ§ë</option>
							    <option value="SOLD_OUT" ${prod.prodType == 'SOLD_OUT' ? 'selected' : ''}>ÌåêÎß§ÏôÑÎ£å</option>
		                	</select>
		                </span>
	                </c:if>
                </c:if>
            </div>
        </div>
        
        <div class="product-location">
            <p><strong>Í±∞Îûò Ìù¨Îßù Ïû•ÏÜå:</strong> ${prod.prodLocation}</p>
            <p><strong>ÏßÄÏó≠:</strong> ${prod.areaName}</p>
        </div>
        
        <div class="product-content">
            ${prod.prodContent}
        </div>
        
        <div class="btn-group">
            <a href="/CarrotEasy/prod/list.do" class="btn btn-back">Î™©Î°ùÏúºÎ°ú</a>
            <div class="btn-group-right">
	            <c:if test="${sessionScope.member.memNo == prod.memNo}">
	                <a href="/CarrotEasy/prod/update.do?prodNo=${prod.prodNo}" class="btn btn-primary">ÏàòÏ†ïÌïòÍ∏∞</a>
	                <button type="button" class="btn btn-primary" onclick="deleteProd(${prod.prodNo})">ÏÇ≠Ï†úÌïòÍ∏∞</button>
	            </c:if>


				<c:if test="${not empty sessionScope.admember}">
				    <!-- Í¥ëÍ≥†Ï£º Í≤ΩÏö∞: ÌÅ¥Î¶≠ Ïãú Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô -->
    				<button type="button" class="btn btn-primary" onclick="alert('ÏùºÎ∞òÌöåÏõêÎßå ÏÇ¨Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.')">
    					ÌåêÎß§Ïûê Ïó∞ÎùΩÌïòÍ∏∞
    				</button>
				</c:if>
	            <c:if test="${sessionScope.member == null && empty sessionScope.admember}">
    				<!-- Î°úÍ∑∏Ïù∏ Ïïà Ìïú Í≤ΩÏö∞: ÌÅ¥Î¶≠ Ïãú Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô -->
<!--     				<button type="button" class="btn btn-primary" onclick="window.location.href='/CarrotEasy/login.do';"> -->
    				<button type="button" class="btn btn-primary" onclick="alert('Î°úÍ∑∏Ïù∏ ÌõÑ Ïù¥Ïö© Í∞ÄÎä•Ìï©ÎãàÎã§.')">
    					ÌåêÎß§Ïûê Ïó∞ÎùΩÌïòÍ∏∞
    				</button>
				</c:if>
				<c:if test="${sessionScope.member != null && sessionScope.member.memNo != prod.memNo && prod.prodType != 'SOLD_OUT'}">
    				<!-- Î°úÍ∑∏Ïù∏ Ìïú Í≤ΩÏö∞: Í∏∞Ï°¥ Ïó∞ÎùΩ Í∏∞Îä• -->
    				<button type="button" class="btn btn-primary" id="sellerTel" data-prodno="${prod.prodNo}" data-memno="${prod.memNo}" data-buyerno=${sessionScope.member.memNo}>
        				ÌåêÎß§Ïûê Ïó∞ÎùΩÌïòÍ∏∞
    				</button>
				</c:if>

	            <c:if test="${sessionScope.member.memNo != prod.memNo && prod.prodType != 'SOLD_OUT' && prod.prodType != 'RESERVED'}">
	            	<c:if test="${not empty sessionScope.admember}">
	            		<button type="button" class="btn-good" onclick="alertTalk()">ÎπÑÎåÄÎ©¥ Íµ¨Îß§ÌïòÍ∏∞</button>
	            	</c:if>
	            	<c:if test="${empty sessionScope.admember}">
				    	<button type="button" class="btn-good" onclick="kakaoPay(prodName,prodPrice,'ÏùºÎ∞òÍµ¨Îß§')">ÎπÑÎåÄÎ©¥ Íµ¨Îß§ÌïòÍ∏∞</button>
	            	</c:if>
				</c:if>
				<c:if test="${sessionScope.member.memNo == prod.memNo && prod.prodType == 'RESERVED'}">
				    <c:choose>
				        <c:when test="${empty deliveryInfo}">
				            <!-- No delivery request exists yet -->
				            <button type="button" class="btn-good" onclick="openWindowPop()">Ïπ¥Ïπ¥Ïò§ÌÄµ Î∞∞ÏÜ°</button>
				        </c:when>
				        <c:otherwise>
				            <!-- Delivery request exists, show tracking button -->
				            <button type="button" class="btn btn-info" onclick="openTrackingPage('${deliveryInfo}', ${prod.prodNo})">Î∞∞ÏÜ°Ï°∞Ìöå</button>
				        </c:otherwise>
				    </c:choose>
				</c:if>
				<c:if test="${sessionScope.member.memNo != null && sessionScope.member.memNo == isPurchase}">
				    <c:choose>
				        <c:when test="${isPurchase != 0 and not hasReview and prod.prodType == 'SOLD_OUT'}">
				            <button class="btn-good" onclick="openinsertPop()">Î¶¨Î∑∞ ÏûëÏÑ±</button>
				        </c:when>
				
				        <c:when test="${hasReview and isPurchase != 0 and prod.prodType == 'SOLD_OUT'}">
				            <form action="/CarrotEasy/review/deleteReviewController.do" method="get">
				                <input type="hidden" name="prodNo" value="${prod.prodNo}" />
				                <input type="hidden" name="memNo" value="${sessionScope.member.memNo}" />
				                <button class="btn-good"  type="submit" onclick="return confirm('Î¶¨Î∑∞Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')">Î¶¨Î∑∞ ÏÇ≠Ï†ú</button>
				            </form>
				        </c:when>
				    </c:choose>
				</c:if>
			</div>
        </div>
    </div>

    <script>
        function changeMainImage(imagePath, thumbnail) {
            // Î©îÏù∏ Ïù¥ÎØ∏ÏßÄ Î≥ÄÍ≤Ω
		    document.getElementById('mainImage').src = '/CarrotEasy' + imagePath;
            
            // ÏÑ†ÌÉùÎêú Ïç∏ÎÑ§Ïùº Í∞ïÏ°∞
            const thumbnails = document.querySelectorAll('.thumbnail');
            thumbnails.forEach(item => {
                item.classList.remove('active');
            });
            thumbnail.classList.add('active');
        }
        
        function deleteProd(prodNo) {
            if (confirm('Ï†ïÎßê Ïù¥ ÏÉÅÌíàÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                fetch("/CarrotEasy/prod/delete.do?prodNo="+prodNo, {
                    method: 'GET' // ÎòêÎäî DELETE, Î∞±ÏóîÎìúÏóê Îî∞Îùº Îã§Î¶Ñ
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('ÏÇ≠Ï†ú ÏöîÏ≤≠ Ïã§Ìå®');
                    }
                    // ÏÑ±Í≥µ Ïãú ÏÉÅÌíà Î™©Î°ù ÌéòÏù¥ÏßÄÎ°ú Ïù¥Îèô
                    location.href = '/CarrotEasy/prod/list.do';
                })
                .catch(error => {
                    console.error('ÏÇ≠Ï†ú Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
                    alert('ÏÉÅÌíà ÏÇ≠Ï†úÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.');
                });
            }
        }
        
        $(document).ready(function() {
        	
        	$('#sellerTel').on('click', function() {
        		var memNo = $(this).data('memno');
        		var prodNo = $(this).data('prodno');
        		var buyerNo = $(this).data('buyerno'); 
        		$('#main-content').load('/CarrotEasy/chattingroom.do?memNo=' + memNo + '&prodNo=' + prodNo +'&buyerNo='+ buyerNo + '&source=prodView');
        		
        	});
        	
        });
        
    </script>
</body>

</html>